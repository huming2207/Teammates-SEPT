<div class="panel panel-default panel-body"
     data-is-session-open="${isSessionOpen}" id="${Const.ParamsNames.FEEDBACK_RESPONSE_TEXT}-${questionIndex}-${responseIndex}"
     name="${Const.ParamsNames.FEEDBACK_RESPONSE_TEXT}-${questionIndex}-${responseIndex}"
     data-length-text-id="responseLength-${questionIndex}-${responseIndex}" data-recommended-text="${recommendedLength}"
     style="display: none;">
    ${existingResponse}
</div>
<div>
    <label for="load-file">Load a file:</label>
    <input type="file" id="load-file" onchange="pdfToBase64()">
</div>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="https://unpkg.com/blob-util@2.0.2/dist/blob-util.js"></script>
<script>
    /*
        Code from https://gist.github.com/nolanlawson/62e747cea7af01542479
        Original implementation is broken and I've made some changes to make it works.
    */
    function pdfToBase64 () {
        var file = $('#load-file')[0].files[0];
        var fileReader = new FileReader();
        fileReader.onloadend = function (e) {
            var arrayBuffer = e.target.result;
            blobUtil.blobToDataURL(blobUtil.arrayBufferToBlob(arrayBuffer, "application/pdf")).then(function (str) {
                console.log(str);
                $("${Const.ParamsNames.FEEDBACK_RESPONSE_TEXT}-${questionIndex}-${responseIndex}").text(str);
            }).catch(function (err) {
                console.log(err);
            });
        };
        fileReader.readAsArrayBuffer(file);
    }
</script>